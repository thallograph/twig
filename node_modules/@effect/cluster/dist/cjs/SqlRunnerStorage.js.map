{"version":3,"file":"SqlRunnerStorage.js","names":["SqlClient","_interopRequireWildcard","require","Arr","Duration","Effect","Layer","Scope","_ClusterError","_resourceRef","RunnerStorage","ShardId","ShardingConfig","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","withTracerDisabled","withTracerEnabled","make","exports","fnUntraced","options","config","disableAdvisoryLocks","shardLockDisableAdvisory","sql","withoutTransforms","prefix","table","name","acquireLockConn","onDialectOrElse","pg","scope","conn","orDie","reserve","pipe","extend","pid","executeValues","addFinalizerExit","executeRaw","mysql","undefined","address","Math","random","Number","MAX_SAFE_INTEGER","taken","orElse","lockConn","ResourceRef","from","runnersTable","runnersTableSql","hasOldTables","isSuccess","ignore","mssql","locksTable","locksTableSql","sqlNowString","sqlNow","literal","expiresSeconds","ceil","toSeconds","shardLockExpiration","toString","lockExpiresAt","encodeBoolean","b","sqlite","insertRunner","runner","healthy","values","unprepared","map","results","machine_id","execWithLockConn","effect","query","params","compile","await","flatMap","onError","unsafeRebuild","execWithLockConnUnprepared","executeUnprepared","execWithLockConnValues","acquireLock","shardIds","shardId","stringLiteral","csv","andThen","acquiredLocks","_address","acquiredShardIds","toAcquire","Map","lockNumbers","takenLocks","length","lockNum","push","lockNumbersReverse","delete","size","rows","pgLocks","allMySqlTakenLocks","lockTakenBy","shardIdsIndex","includes","mysqlLocks","withTransaction","shardGroups","group","base","shard","shardsPerGroup","lockNames","lockNamesReverse","index","lockName","shardIdsMap","Array","entries","join","stringLiteralArr","row","wrapString","s","arr","refreshShards","shardIdsStr","shard_id","makeEncoded","getRunners","PersistenceError","refail","String","Boolean","register","unregister","asVoid","setRunnerHealth","acquire","refresh","as","release","releaseAll","layer","scoped","layerWith"],"sources":["../../src/SqlRunnerStorage.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}