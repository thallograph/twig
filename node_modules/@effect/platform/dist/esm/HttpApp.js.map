{"version":3,"file":"HttpApp.js","names":["Cause","Context","Effect","Exit","Fiber","GlobalValue","Layer","Option","Runtime","Scope","Stream","unify","HttpBody","ServerError","ServerRequest","ServerResponse","internal","internalMiddleware","handledSymbol","Symbol","for","toHandled","self","handleResponse","middleware","responded","withFiberRuntime","fiber","flatMap","response","request","unsafeGet","currentContext","HttpServerRequest","handler","getFiberRef","currentPreResponseHandlers","_tag","as","tap","value","withErrorHandling","catchAllCause","cause","causeResponse","zipRight","isEmptyType","succeed","failCause","withMiddleware","undefined","tracer","matchCauseEffect","onFailure","void","_cause","empty","status","onSuccess","uninterruptible","scoped","ejectDefaultScopeClose","scope","ejectedScopes","add","unsafeEjectStreamScope","body","getOrThrow","getCurrentFiber","setBody","stream","ensuring","close","contentType","contentLength","globalValue","WeakSet","effect","make","onExit","extend","exit","has","appendPreResponseHandler","withPreResponseHandler","toWebHandlerRuntime","runtime","httpRuntime","run","runFork","resolveSymbol","httpApp","toWeb","withoutBody","method","context","Promise","resolve","contextMap","Map","unsafeMap","isContext","key","set","httpServerRequest","fromWeb","unsafeMake","signal","addEventListener","unsafeInterruptAsFork","clientAbortFiberId","once","toWebHandler","defaultRuntime","toWebHandlerLayerWith","layer","options","runSync","dispose","runPromise","handlerCache","handlerPromise","gen","memoMap","toRuntimeWithMemoMap","toRuntime","toHandler","pipe","then","f","toWebHandlerLayer","fromWebHandler","async","resume","requestResult","toWebEither","fiberRefs","getFiberRefs","runtimeFlags","defaultRuntimeFlags","fail","left","right","RequestError","reason","description"],"sources":["../../src/HttpApp.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}