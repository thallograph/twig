{"version":3,"file":"entityManager.js","names":["_RpcMessage","require","RpcServer","_interopRequireWildcard","Arr","Cause","Context","Duration","Effect","Equal","Exit","FiberRef","_Function","HashMap","Metric","Option","ParseResult","Runtime","Schedule","Schema","Scope","_ClusterError","ClusterMetrics","_ClusterSchema","_Entity","Message","MessageStorage","Reply","_ShardingConfig","Snowflake","_entityReaper","_fiber","_interruptors","_resourceMap","_resourceRef","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","make","exports","fnUntraced","entity","buildHandlers","options","config","ShardingConfig","snowflakeGen","Generator","managerScope","scope","storageEnabled","storage","noop","mailboxCapacity","entityMailboxCapacity","clock","context","retryDriver","driver","defectRetryPolicy","andThen","defaultRetryPolicy","entityRpcs","Map","protocol","requests","KeepAliveRpc","_tag","activeServers","serverCloseLatches","processedRequestIds","Set","entities","ResourceMap","address","sharding","hasShardId","shardId","EntityNotAssignedToRunner","endLatch","unsafeMakeLatch","keepAliveLatch","addFinalizerExit","unsafeOpen","delete","void","activeRequests","defectRequestIds","writeRef","ResourceRef","from","isShuttingDown","handlers","toHandlersContext","pipe","provide","add","CurrentAddress","CurrentRunnerAddress","runnerAddress","KeepAliveLatch","locally","currentLogAnnotations","empty","server","makeNoSerialization","spanPrefix","type","entityId","spanAttributes","concurrency","disableFatalDefects","onFromServer","response","request","requestId","sentReply","rpc","annotations","Persisted","isFailure","exit","isInterrupted","Uninterruptible","forServer","write","message","envelope","id","RequestId","tag","payload","Request","lastSentChunk","forkIn","unregisterReplyHandler","retryRespond","suspend","respond","WithExit","unsafeNext","flatMap","size","state","lastActiveCheck","unsafeCurrentTimeMillis","orDie","sequence","reply","Chunk","values","some","onDefect","die","defect","open","extend","addFinalizer","sync","length","cause","effect","unsafeRebuild","Array","keys","logError","ignore","next","annotateLogs","module","runner","catchAllCause","clientId","current","await","value","keepAliveEnabled","withFiberRuntime","fiber","internalInterruptors","interruptible","timeoutOption","entityTerminationTimeout","reaper","EntityReaper","maxIdleTime","toMillis","entityMaxIdleTime","Number","isFinite","register","servers","gauge","tagged","unsafeUpdate","BigInt","sleep","forever","sendLocal","entry","fail","AlreadyProcessingMessage","envelopeId","dieMessage","msg","whenOpen","asVoid","MailboxFull","lastSentReply","match","onNone","onSome","isSome","replyId","interruptors","decodeMessage","makeMessageDecode","runFork","runtime","identity","interruptShard","loop","fibers","forEach","symbol","push","removeIgnore","latch","joinAllDiscard","isProcessingFor","excludeReplies","undefined","clearProcessed","clear","send","matchEffect","onFailure","MalformedMessage","ReplyWithContext","onSuccess","decoded","IncomingEnvelope","IncomingRequestLocal","activeEntityCount","exponential","union","spaced","decodeRequest","decode","payloadSchema","asSome","succeedNone","map","succeed","ParseError","issue","Unexpected","times","catchAll","delay"],"sources":["../../../src/internal/entityManager.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}