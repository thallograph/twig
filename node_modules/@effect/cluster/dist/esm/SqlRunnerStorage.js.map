{"version":3,"file":"SqlRunnerStorage.js","names":["SqlClient","Arr","Duration","Effect","Layer","Scope","PersistenceError","ResourceRef","RunnerStorage","ShardId","ShardingConfig","withTracerDisabled","withTracerEnabled","make","fnUntraced","options","config","disableAdvisoryLocks","shardLockDisableAdvisory","sql","withoutTransforms","prefix","table","name","acquireLockConn","onDialectOrElse","pg","scope","conn","orDie","reserve","pipe","extend","pid","executeValues","addFinalizerExit","executeRaw","mysql","undefined","address","Math","random","Number","MAX_SAFE_INTEGER","taken","orElse","lockConn","from","runnersTable","runnersTableSql","hasOldTables","isSuccess","ignore","mssql","locksTable","locksTableSql","sqlNowString","sqlNow","literal","expiresSeconds","ceil","toSeconds","shardLockExpiration","toString","lockExpiresAt","encodeBoolean","b","sqlite","insertRunner","runner","healthy","values","unprepared","map","results","machine_id","execWithLockConn","effect","query","params","compile","await","flatMap","onError","unsafeRebuild","execWithLockConnUnprepared","executeUnprepared","execWithLockConnValues","acquireLock","shardIds","shardId","stringLiteral","csv","andThen","acquiredLocks","_address","acquiredShardIds","toAcquire","Map","lockNumbers","get","takenLocks","i","length","lockNum","push","lockNumbersReverse","delete","size","rows","pgLocks","allMySqlTakenLocks","lockTakenBy","shardIdsIndex","includes","mysqlLocks","withTransaction","shardGroups","group","base","shard","shardsPerGroup","set","lockNames","lockNamesReverse","index","lockName","shardIdsMap","Array","entries","join","stringLiteralArr","row","wrapString","s","arr","refreshShards","shardIdsStr","shard_id","makeEncoded","getRunners","refail","String","Boolean","register","unregister","asVoid","setRunnerHealth","acquire","refresh","as","release","releaseAll","layer","scoped","layerWith"],"sources":["../../src/SqlRunnerStorage.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}