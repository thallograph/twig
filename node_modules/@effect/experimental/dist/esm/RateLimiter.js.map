{"version":3,"file":"RateLimiter.js","names":["Context","Duration","Effect","identity","Layer","Schema","TypeId","RateLimiter","GenericTag","make","gen","store","RateLimiterStore","consume","options","tokens","onExceeded","algorithm","window","decode","windowMillis","toMillis","refillRate","unsafeDivide","limit","refillRateMillis","fail","RateLimitExceeded","key","retryAfter","remaining","succeed","delay","resetAfter","flatMap","fixedWindow","undefined","count","ttl","millis","zero","ttlTotal","elapsed","windowNumber","Math","floor","times","ceil","tokenBucket","allowOverflow","layer","effect","makeWithRateLimiter","map","limiter","isZero","makeSleep","result","as","sleep","ErrorTypeId","TaggedError","DurationFromMillis","String","Number","reason","message","RateLimitStoreError","cause","optional","Defect","RateLimiterError","Union","Tag","layerStoreMemory","sync","fixedCounters","Map","tokenBuckets","of","clockWith","clock","now","unsafeCurrentTimeMillis","counter","get","expiresAt","set","bucket","lastRefill","tokensToAdd","min","newTokenCount"],"sources":["../../src/RateLimiter.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}