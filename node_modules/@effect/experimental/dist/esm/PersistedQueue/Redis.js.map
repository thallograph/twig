{"version":3,"file":"Redis.js","names":["Cause","Config","Duration","Effect","Exit","Layer","Mailbox","MutableRef","Option","RcMap","Schedule","Redis","PersistedQueue","make","fnUntraced","options","pollInterval","decode","seconds","redis","acquireRelease","sync","promise","quit","defineCommand","lua","numberOfKeys","readOnly","lockRefreshMillis","lockRefreshInterval","toMillis","lockExpirationMillis","lockExpiration","prefix","keyQueue","name","keyLock","id","keyPending","keyFailed","workerId","crypto","randomUUID","mailboxes","lookup","queueKey","pendingKey","mailbox","takers","pollLatch","unsafeMakeLatch","takenLatch","addFinalizer","flatMap","clear","elements","length","void","Promise","all","Array","from","element","requeue","JSON","stringify","resetQueue","pipe","andThen","sleep","forever","forkScoped","interruptible","poll","size","take","gen","await","yieldNow","results","current","unsafeClose","offerAll","map","json","parse","sandbox","retry","spaced","idleTimeToLive","activeLockKeys","Set","forEach","key","pexpire","annotateLogs","package","module","fiber","PersistedQueueStore","of","offer","isCustomId","tryPromise","try","attempts","lpush","catch","cause","PersistedQueueError","message","uninterruptibleMask","restore","get","unsafeOpen","tap","getOrUndefined","unsafeSize","scoped","lock","add","match","onFailure","delete","nextAttempts","maxAttempts","failed","lastFailure","pretty","renderErrorCause","isInterruptedOnly","onSuccess","complete","layerStore","layerStoreConfig","unwrap"],"sources":["../../../src/PersistedQueue/Redis.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}