{"version":3,"file":"PersistedQueue.js","names":["Context","_interopRequireWildcard","require","Effect","Exit","Iterable","Layer","Schema","Scope","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","TypeId","exports","PersistedQueueFactory","Tag","make","options","flatMap","factory","makeFactory","gen","store","PersistedQueueStore","of","encodeUnknown","schema","decodeUnknown","succeed","offer","value","opts","element","id","crypto","randomUUID","as","name","isCustomId","undefined","take","uninterruptibleMask","fnUntraced","restore","scope","item","maxAttempts","pipe","extend","exit","attempts","close","layer","effect","ErrorTypeId","PersistedQueueError","TaggedError","message","String","cause","optional","Defect","layerStoreMemory","sync","ids","Set","queues","Map","getOrCreateQueue","queue","latch","unsafeMakeLatch","items","add","unsafeOpen","await","unsafeHead","delete","size","unsafeClose","addFinalizer","_tag","void","isInterrupted"],"sources":["../../src/PersistedQueue.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}