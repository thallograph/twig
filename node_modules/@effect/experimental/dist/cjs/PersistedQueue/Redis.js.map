{"version":3,"file":"Redis.js","names":["Cause","_interopRequireWildcard","require","Config","Duration","Effect","Exit","Layer","Mailbox","MutableRef","Option","RcMap","Schedule","_ioredis","PersistedQueue","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","make","exports","fnUntraced","options","pollInterval","decode","seconds","redis","acquireRelease","sync","Redis","promise","quit","defineCommand","lua","numberOfKeys","readOnly","lockRefreshMillis","lockRefreshInterval","toMillis","lockExpirationMillis","lockExpiration","prefix","keyQueue","name","keyLock","id","keyPending","keyFailed","workerId","crypto","randomUUID","mailboxes","lookup","queueKey","pendingKey","mailbox","takers","pollLatch","unsafeMakeLatch","takenLatch","addFinalizer","flatMap","clear","elements","length","void","Promise","all","Array","from","element","requeue","JSON","stringify","resetQueue","pipe","andThen","sleep","forever","forkScoped","interruptible","poll","size","take","gen","await","yieldNow","results","current","unsafeClose","offerAll","map","json","parse","sandbox","retry","spaced","idleTimeToLive","activeLockKeys","Set","forEach","key","pexpire","annotateLogs","package","module","fiber","PersistedQueueStore","of","offer","isCustomId","tryPromise","try","attempts","lpush","catch","cause","PersistedQueueError","message","uninterruptibleMask","restore","unsafeOpen","tap","getOrUndefined","unsafeSize","scoped","lock","add","match","onFailure","delete","nextAttempts","maxAttempts","failed","lastFailure","pretty","renderErrorCause","isInterruptedOnly","onSuccess","complete","layerStore","layerStoreConfig","unwrap"],"sources":["../../../src/PersistedQueue/Redis.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}