{"version":3,"file":"HttpApp.js","names":["Cause","_interopRequireWildcard","require","Context","Effect","Exit","Fiber","GlobalValue","Layer","Option","Runtime","Scope","Stream","_Unify","HttpBody","ServerError","ServerRequest","ServerResponse","internal","internalMiddleware","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","handledSymbol","Symbol","for","toHandled","self","handleResponse","middleware","responded","withFiberRuntime","fiber","flatMap","response","request","unsafeGet","currentContext","HttpServerRequest","handler","getFiberRef","currentPreResponseHandlers","_tag","as","tap","value","withErrorHandling","catchAllCause","cause","causeResponse","zipRight","isEmptyType","succeed","failCause","withMiddleware","unify","undefined","tracer","matchCauseEffect","onFailure","void","_cause","empty","status","onSuccess","uninterruptible","scoped","exports","ejectDefaultScopeClose","scope","ejectedScopes","add","unsafeEjectStreamScope","body","getOrThrow","getCurrentFiber","setBody","stream","ensuring","close","contentType","contentLength","globalValue","WeakSet","effect","make","onExit","extend","exit","appendPreResponseHandler","withPreResponseHandler","toWebHandlerRuntime","runtime","httpRuntime","run","runFork","resolveSymbol","httpApp","toWeb","withoutBody","method","context","Promise","resolve","contextMap","Map","unsafeMap","isContext","key","httpServerRequest","fromWeb","unsafeMake","signal","addEventListener","unsafeInterruptAsFork","clientAbortFiberId","once","toWebHandler","defaultRuntime","toWebHandlerLayerWith","layer","options","runSync","dispose","runPromise","handlerCache","handlerPromise","gen","memoMap","toRuntimeWithMemoMap","toRuntime","toHandler","pipe","then","toWebHandlerLayer","fromWebHandler","async","resume","requestResult","toWebEither","fiberRefs","getFiberRefs","runtimeFlags","defaultRuntimeFlags","fail","left","right","RequestError","reason","description"],"sources":["../../src/HttpApp.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}